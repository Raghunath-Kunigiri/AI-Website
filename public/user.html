<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sources Hub | User Login</title>
    <link rel="stylesheet" href="output.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <a href="Index.html" class="flex items-center space-x-2 hover:text-gray-200 transition">
                        <i class="fas fa-robot text-3xl"></i>
                        <h1 class="text-2xl font-bold">AI Sources Hub</h1>
                    </a>
                </div>
                <a href="index.html" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition font-medium">
                    <i class="fas fa-home mr-2"></i>Back to Home
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Login/Signup Section -->
        <section class="bg-white rounded-xl shadow-sm p-8 max-w-md mx-auto animate-fade-in">
            <div class="flex border-b border-gray-200 mb-6">
                <button id="loginTab" class="flex-1 py-2 text-center font-semibold text-primary border-b-2 border-primary">Login</button>
                <button id="signupTab" class="flex-1 py-2 text-center font-semibold text-gray-600">Sign Up</button>
            </div>

            <!-- Social Login Options -->
            <div class="mb-6">
                <p class="text-center text-gray-600 mb-4">Sign in with</p>
                <div class="flex justify-center space-x-4">
                    <!-- Google Sign-In Button -->
                    <div id="g_id_onload"
                         data-client_id="<%= process.env.GOOGLE_CLIENT_ID %>"
                         data-context="signin"
                         data-ux_mode="popup"
                         data-callback="handleGoogleSignIn"
                         data-auto_prompt="false">
                    </div>
                    
                    <div class="g_id_signin"
                         data-type="standard"
                         data-shape="rectangular"
                         data-theme="outline"
                         data-text="signin_with"
                         data-size="large"
                         data-logo_alignment="left">
                    </div>
                </div>
                <div class="relative flex items-center my-6">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="flex-shrink mx-4 text-gray-600">or</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>
            </div>

            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginEmail" class="block text-gray-700 mb-1">Email</label>
                    <input type="email" id="loginEmail" required
                           class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="loginPassword" class="block text-gray-700 mb-1">Password</label>
                    <input type="password" id="loginPassword" required
                           class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <input type="checkbox" id="remember" class="mr-2">
                        <label for="remember" class="text-gray-700">Remember me</label>
                    </div>
                    <a href="#" class="text-primary hover:text-primary/80 transition">Forgot password?</a>
                </div>
                <button type="submit" class="w-full py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition font-medium">
                    Login
                </button>
                <div id="loginError" class="text-red-500 text-sm mt-4 hidden"></div>
            </form>

            <!-- Signup Form -->
            <form id="signupForm" class="space-y-4 hidden">
                <div>
                    <label for="signupEmail" class="block text-gray-700 mb-1">Email</label>
                    <input type="email" id="signupEmail" required
                           class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="signupPassword" class="block text-gray-700 mb-1">Password</label>
                    <input type="password" id="signupPassword" required
                           class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <div>
                    <label for="confirmPassword" class="block text-gray-700 mb-1">Confirm Password</label>
                    <input type="password" id="confirmPassword" required
                           class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                <button type="submit" class="w-full py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition font-medium">
                    Sign Up
                </button>
                <div id="signupError" class="text-red-500 text-sm mt-4 hidden"></div>
            </form>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-8">
        <div class="container mx-auto px-4">
            <div class="text-center text-gray-400">
                <p>Â© 2025 AI Sources Hub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>

        // Set the client ID dynamically
  document.addEventListener('DOMContentLoaded', function() {
    const gIdOnload = document.getElementById('g_id_onload');
    gIdOnload.setAttribute('data-client_id', window.appConfig.googleClientId);
  });
        // DOM Elements
        const loginTab = document.getElementById('loginTab');
        const signupTab = document.getElementById('signupTab');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const loginError = document.getElementById('loginError');
        const signupError = document.getElementById('signupError');

        // Tab Switching
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('text-primary', 'border-primary', 'border-b-2');
            signupTab.classList.remove('text-primary', 'border-primary', 'border-b-2');
            signupTab.classList.add('text-gray-600');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            loginError.classList.add('hidden');
            signupError.classList.add('hidden');
        });

        signupTab.addEventListener('click', () => {
            signupTab.classList.add('text-primary', 'border-primary', 'border-b-2');
            loginTab.classList.remove('text-primary', 'border-primary', 'border-b-2');
            loginTab.classList.add('text-gray-600');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            loginError.classList.add('hidden');
            signupError.classList.add('hidden');
        });

        function handleGoogleSignIn(response) {
            // Decode the JWT token to get user information
            const responsePayload = decodeJwtResponse(response.credential);
            
            // Extract user data
            const email = responsePayload.email;
            const name = responsePayload.name;
            const picture = responsePayload.picture;
            
            // Check if user exists in local storage
            const users = JSON.parse(localStorage.getItem('users')) || [];
            let user = users.find(u => u.email === email);
            
            // If user doesn't exist, create a new account
            if (!user) {
                user = { 
                    email, 
                    name,
                    picture,
                    authProvider: 'google',
                    favorites: [] 
                };
                users.push(user);
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // Set logged in user and redirect
            localStorage.setItem('loggedInUser', JSON.stringify(user));
            window.location.href = 'index.html';
        }
        
        // Function to decode JWT token
        function decodeJwtResponse(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }


        signupForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('signupEmail').value.trim();
    const username = document.getElementById('signupUsername').value.trim();
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const contactDetails = document.getElementById('contactDetails').value.trim();

    if (!email.endsWith('@gmail.com')) {
        signupError.textContent = 'Please enter a valid Gmail address.';
        signupError.classList.remove('hidden');
        return;
    }
    if (password !== confirmPassword) {
        signupError.textContent = 'Passwords do not match.';
        signupError.classList.remove('hidden');
        return;
    }
    if (!/^\+?\d{10,15}$/.test(contactDetails.replace(/[-()\s]/g, ''))) {
        signupError.textContent = 'Please enter a valid phone number.';
        signupError.classList.remove('hidden');
        return;
    }

    try {
        const response = await fetch(`${API_URL}/users`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, username, password, contact_details: contactDetails, favorites: [] })
        });
        if (!response.ok) throw new Error(await response.text());
        signupSuccess.textContent = 'Account created successfully! Redirecting...';
        signupSuccess.classList.remove('hidden');
        setTimeout(() => { window.location.href = 'index.html'; }, 2000);
    } catch (error) {
        signupError.textContent = error.message;
        signupError.classList.remove('hidden');
    }
});

loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;

    try {
        const response = await fetch(`${API_URL}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        if (!response.ok) throw new Error(await response.text());
        const user = await response.json();
        localStorage.setItem('loggedInUser', JSON.stringify(user));
        window.location.href = 'index.html';
    } catch (error) {
        loginError.textContent = error.message;
        loginError.classList.remove('hidden');
    }
});
        const API_URL = window.location.hostname.includes('localhost')
    ? 'http://localhost:8000/api'
    : 'https://aisources.onrender.com/api';
    </script>
</body>
</html>